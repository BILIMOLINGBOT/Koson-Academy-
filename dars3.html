<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ispan Tili Darsi ‚Äì Olmoshlar (qora fon)</title>
    <style>
        /* Qora fon, oq matn ‚Äì minimal va kontrastli */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Tahoma', Geneva, Verdana, sans-serif;
            background-color: #000000;  /* qora fon */
            color: #ffffff;            /* matn rangi oq */
            line-height: 1.7;
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .lesson-card {
            background-color: #0a0a0a;  /* juda to'q kulrang, qoraga yaqin */
            border: 1px solid #333333;
            border-radius: 18px;
            padding: 30px 28px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(255,255,255,0.03);
            transition: border 0.2s;
        }

        .lesson-card:hover {
            border-color: #5f5f5f;
        }

        h2 {
            color: #f0f0f0;          /* oq rangga yaqin */
            border-bottom: 2px solid #b3002d; /* qizil ohang ‚Äì ispancha tus */
            padding-bottom: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        p, li {
            color: #ffffff;           /* to‚Äòliq oq matn */
        }

        .spanish-word {
            color: #ffb3b3;           /* och qizg‚Äòish, oq fonda emas ‚Äì yumshoq sarg'ish oq emas, lekin ko'zga tashlanadi */
            font-weight: 700;
            cursor: pointer;
            border-bottom: 1px dashed #cc6666;
            padding: 1px 4px 1px 4px;
            transition: background 0.2s, color 0.2s;
            background-color: rgba(200, 200, 200, 0.05);
            border-radius: 4px;
        }

        .spanish-word:hover {
            background-color: #3a1a1a;  /* qora fonga mos qizg'ish shisha effekt */
            border-bottom: 1px solid #ff9999;
            color: #ffe6e6;
        }

        .pronunciation-tip {
            background-color: #1e1e1e;    /* qoraga yaqin, farqli fon */
            border-left: 6px solid #b3002d; /* qizil aksent */
            padding: 18px 22px;
            margin: 25px 0;
            color: #f2f2f2;
            border-radius: 0 12px 12px 0;
            font-style: italic;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.7);
        }

        .pronunciation-tip strong {
            color: #ffaeae;
            font-style: normal;
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

        li {
            margin-bottom: 14px;
            padding-left: 8px;
            border-left: 3px solid #5a5a5a;
            font-size: 1.05rem;
        }

        /* POPUP ‚Äì qora fonli, oq matn, aniq ko'rinadi */
        #popup {
            display: none;
            position: absolute;
            background-color: #121212;  /* qora popup, biroz yorqinlik */
            color: white;
            padding: 14px 20px;
            border-radius: 40px 40px 40px 8px;  /* zamonaviy */
            box-shadow: 0 12px 30px rgba(255,255,255,0.12);
            z-index: 9999;
            align-items: center;
            gap: 18px;
            font-size: 1rem;
            border: 1px solid #4d4d4d;
            backdrop-filter: blur(2px);
            transition: opacity 0.15s;
            max-width: 280px;
        }

        #popup::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -8px;
            border-width: 8px;
            border-style: solid;
            border-color: #121212 transparent transparent transparent;
        }

        #popup-text {
            font-weight: 500;
            color: #ffffff;
            letter-spacing: 0.3px;
            background: rgba(255,255,255,0.1);
            padding: 5px 14px;
            border-radius: 40px;
        }

        .audio-icon {
            width: 28px;
            height: 28px;
            cursor: pointer;
            fill: white;              /* oq karnaycha */
            transition: transform 0.15s, fill 0.2s;
            background-color: rgba(255,255,255,0.1);
            border-radius: 50%;
            padding: 5px;
        }

        .audio-icon:hover {
            transform: scale(1.2);
            fill: #ffc107;            /* sariqcha tus */
            background-color: rgba(255,200,50,0.2);
        }

        /* mobil va kichik ekran */
        @media (max-width: 650px) {
            .lesson-card {
                padding: 20px 18px;
            }
            #popup {
                max-width: 220px;
                font-size: 0.95rem;
            }
        }

        /* talaffuz siri ichidagi ispancha so'zlar ham oq rangda */
        .pronunciation-tip .spanish-word {
            background-color: #1e2b2b;
            border-color: #e68a8a;
            color: #ffcaca;
        }

        /* oq matn uchun alohida */
        a, .spanish-word:focus {
            outline: 1px dotted rgba(255,255,255,0.5);
        }

        strong {
            color: #ffd1d1;
        }
    </style>
</head>
<body>

    <!-- Dars karta: √âl -->
    <div class="lesson-card">
        <h2>√âl (U ‚Äî erkaklar uchun)</h2>
        <p style="color:#dddddd;">Bu olmosh faqat erkak jinsidagi shaxslarga nisbatan ishlatiladi.</p>
        <ul>
            <li><span class="spanish-word" data-tr="U non yeydi">√âl come pan</span>. ‚Äì U non yeydi.</li>
            <li><span class="spanish-word" data-tr="U suv ichadi">√âl bebe agua</span>. ‚Äì U suv ichadi.</li>
            <li><span class="spanish-word" data-tr="U ispan tilini o‚Äòrganadi">√âl estudia espa√±ol</span>. ‚Äì U ispan tilini o‚Äòrganadi.</li>
        </ul>
    </div>

    <!-- Dars karta: Ella + talaffuz siri -->
    <div class="lesson-card">
        <h2>Ella (U ‚Äî ayollar uchun)</h2>
        <p style="color:#dddddd;">Ayol jinsidagi shaxslar uchun <strong>Ella</strong> olmoshini ishlatamiz.</p>
        
        <div class="pronunciation-tip">
            <strong>üó£Ô∏è Talaffuz siri:</strong><br>
            Ispan tilida ikkita "ll" harfi yonma-yon kelsa, u "y" kabi o‚Äòqiladi.<br>
            ‚ú¶ <span class="spanish-word" data-tr="U (ayol) - talaffuzi: eya">Ella</span> deb yoziladi, lekin <strong style="color:#ffb3b3;">"Eya"</strong> deb talaffuz qilinadi.
        </div>

        <ul>
            <li><span class="spanish-word" data-tr="U non yeydi">Ella come pan</span> ‚Äì U non yeydi.</li>
            <li><span class="spanish-word" data-tr="U suv ichadi">Ella bebe agua</span> ‚Äì U suv ichadi.</li>
            <li><span class="spanish-word" data-tr="U ispan tilini o‚Äòrganadi">Ella estudia espa√±ol</span> ‚Äì U ispan tilini o‚Äòrganadi.</li>
        </ul>
    </div>

    <!-- Popup ‚Äì tarjima va audio -->
    <div id="popup">
        <span id="popup-text"></span>
        <svg class="audio-icon" id="speak-btn" viewBox="0 0 24 24" width="28" height="28">
            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
        </svg>
    </div>

    <script>
        (function() {
            "use strict";

            // HAR BIR so'z bosilganda popup ochilishi va to'g'ri ishlash
            const words = document.querySelectorAll('.spanish-word');
            const popup = document.getElementById('popup');
            const popupText = document.getElementById('popup-text');
            const speakBtn = document.getElementById('speak-btn');
            let currentText = "";            // ispancha matn (ovoz uchun)
            let clickTimer = null;          // kichik himoya, event bubbling

            // BARCHA .spanish-word uchun click hodisasi
            words.forEach(word => {
                word.addEventListener('click', function(event) {
                    // popupni to'liq boshqarish
                    event.stopPropagation();  // hujjat click'iga o'tmasligi uchun (popup yopilmasin darhol)
                    
                    // Hozirgi ispancha matn va tarjima
                    currentText = this.innerText.trim();   // ovoz sint ezasi uchun
                    const translation = this.getAttribute('data-tr') || "tarjima mavjud emas";

                    // Popup matnini o'rnat
                    popupText.innerText = translation;

                    // Ko'rinadigan qilish (pozitsiyasini hisoblashdan oldin display block bo'lishi kerak)
                    popup.style.display = 'flex';

                    // Koordinatalar ‚Äì so'zning joylashuvi
                    const rect = this.getBoundingClientRect();
                    const scrollY = window.scrollY || window.pageYOffset;
                    const scrollX = window.scrollX || window.pageXOffset;

                    // Popup o'lchamlarini olaylik
                    const popupWidth = popup.offsetWidth;
                    const popupHeight = popup.offsetHeight;

                    // Ideal pozitsiya: so'zning o'rtasiga nisbatan, yuqoriga
                    let leftPos = rect.left + (rect.width / 2) - (popupWidth / 2) + scrollX;
                    let topPos = rect.top + scrollY - popupHeight - 12;  // 12px yuqoridan masofa

                    // Agar ekran chetiga chiqib ketsa, pastga qarab joylashtirish (mobil yoki chekka)
                    if (topPos < scrollY + 10) {
                        topPos = rect.bottom + scrollY + 15;
                        // popup strelkasini teskari qilish (yuqoriga qaratsak)
                        popup.style.transform = 'rotate(0deg)';
                        // ::after hozir pastki o'q, agar popup pastga tushsa strelkani yuqoriga qaratish kerak
                        // Buning uchun maxsus klass qo'shish mumkin, ammo sodda: 
                        popup.style.setProperty('--after-top', '-16px');
                        popup.style.setProperty('--after-border', 'transparent transparent #121212 transparent');
                        // Lekin biz faqat inline orqali boshqaramiz ‚Äì qisqa usul:
                        popup.style.transform = 'none'; 
                        // strelkani tepaga qaratish uchun ::after ni o'zgartirolmaymiz to'liq. 
                        // Eng oson ‚Äì transform bilan strelka yo'nalishini almashtirish: 
                        // qo'shimcha style qo'shamiz. 
                        const styleTag = document.getElementById('popup-arrow-style') || document.createElement('style');
                        styleTag.id = 'popup-arrow-style';
                        styleTag.innerHTML = `
                            #popup::after {
                                top: -16px !important;
                                bottom: auto !important;
                                border-color: transparent transparent #121212 transparent !important;
                                border-width: 8px;
                                margin-left: -8px;
                            }
                        `;
                        document.head.appendChild(styleTag);
                    } else {
                        // standart: strelka pastga qaraydi
                        const existing = document.getElementById('popup-arrow-style');
                        if (existing) existing.remove();
                        popup.style.transform = '';
                    }

                    // chegara ‚Äì chap tomondan chiqmasin
                    if (leftPos < scrollX + 5) leftPos = scrollX + 10;
                    if (leftPos + popupWidth > window.innerWidth + scrollX - 15) {
                        leftPos = window.innerWidth + scrollX - popupWidth - 15;
                    }

                    popup.style.left = `${leftPos}px`;
                    popup.style.top = `${topPos}px`;

                    // Bu yerda muhim: event to'xtagan, lekin boshqa joyga bosilsa popup yopiladi.
                    // Shuning uchun qisqa muddatga boshqa clicklarni bloklash shart emas.
                });
            });

            // Karnaycha bosilganda ispancha talaffuz
            speakBtn.addEventListener('click', function(event) {
                event.stopPropagation();   // popup yopilmasligi uchun
                if (currentText.trim() === "") {
                    // agar biron sabab bilan matn bo'sh bo'lsa, default misol
                    currentText = "Espa√±ol";
                }
                // Ispan tali talaffuzi
                const utterance = new SpeechSynthesisUtterance(currentText);
                utterance.lang = 'es-ES';
                utterance.rate = 0.95;
                window.speechSynthesis.cancel(); // oldingi ovozni to'xtatish (ziddiyatsiz)
                window.speechSynthesis.speak(utterance);
            });

            // Butun sahifa bosilganda popupni yopish. 
            // Lekin so'z yoki speakBtn bosilganda popup yopilmasligi uchun stopPropagation qilganmiz.
            document.addEventListener('click', function(e) {
                // Agar popup ochiq bo'lsa va bosilgan element popup ichida yoki .spanish-word bo'lmasa
                if (popup.style.display === 'flex') {
                    // Agar bosilgan element .spanish-word, popup yoki audio-icon bo'lmasa ‚Äì yopamiz
                    const isWord = e.target.classList.contains('spanish-word');
                    const isPopup = e.target.closest('#popup');
                    const isAudio = e.target.closest('.audio-icon');
                    
                    if (!isWord && !isPopup && !isAudio) {
                        popup.style.display = 'none';
                        // strelka stilini tozalash (keyingi popup uchun)
                        const arrowStyle = document.getElementById('popup-arrow-style');
                        if (arrowStyle) arrowStyle.remove();
                    }
                }
            });

            // Popup ichidagi bosilganda yopilmasligi (speakBtn uchun allaqachon stopPropagation)
            popup.addEventListener('click', function(e) {
                e.stopPropagation();
            });

            // Agar oyna o'lchami o'zgarsa, popupni yopish (pozitsiya buzilmasligi uchun)
            window.addEventListener('resize', function() {
                popup.style.display = 'none';
                const arrowStyle = document.getElementById('popup-arrow-style');
                if (arrowStyle) arrowStyle.remove();
            });

            // Scroll paytida popupni yopish (xalal bermaslik uchun) ‚Äî ixtiyoriy
            window.addEventListener('scroll', function() {
                if (popup.style.display === 'flex') {
                    popup.style.display = 'none';
                    const arrowStyle = document.getElementById('popup-arrow-style');
                    if (arrowStyle) arrowStyle.remove();
                }
            }, { passive: true });

            // Barcha ispancha so'zlar bosilganda popup ochiladi (va yopilmaydi darhol)
            // Yuqoridagi kod yetarli. 
        })();
    </script>

    <!-- Eslatma: hamma so'zlar, shu jumladan Ella talaffuz qismidagi so'z ham bosiladi -->
    <!-- Orqa fon qora, matn oq. Popup ham qora va oq matn. -->
</body>
</html>