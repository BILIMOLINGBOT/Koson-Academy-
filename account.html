<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Javlonbek Rashidov Profil</title>
  <style>
    /* Mavjud CSS'ingiz shu yerda qoladi. Quyida yangi qismlar qo'shiladi */

    /* Modal va Tahrirlash Stilari */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: #1a1a1a;
      padding: 20px;
      border-radius: 10px;
      width: 80%;
      max-width: 400px;
      color: #fff;
      box-shadow: 0 0 15px #ff00cc;
    }

    .modal-content input, .modal-content select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      background-color: #2a2a2a;
      border: none;
      color: #fff;
      border-radius: 5px;
    }

    .modal-content button {
      padding: 10px;
      background: linear-gradient(45deg, #ff00cc, #6600ff);
      border: none;
      color: #fff;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 10px;
    }

    .close-modal {
      float: right;
      cursor: pointer;
      color: #ff00cc;
    }

    /* Video Tahrirlash Sahifasi */
    .editor-container {
      display: none;
      position: relative;
      margin: 20px auto;
      width: 80%;
      max-width: 600px;
      background-color: #121212;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px #ff00cc;
    }

    .video-preview {
      width: 100%;
      height: auto;
      position: relative;
    }

    .video-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none; /* Stickerlarga ta'sir qilmasin */
    }

    .sticker {
      position: absolute;
      background-color: rgba(255, 0, 204, 0.7); /* Default rang */
      padding: 10px;
      border-radius: 10px;
      cursor: move;
      pointer-events: all;
      min-width: 100px;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: #fff;
      font-size: 16px;
      box-shadow: 0 0 10px #ff00cc;
      resize: both; /* Resize imkoniyati */
      overflow: auto;
    }

    .sticker .delete-btn {
      position: absolute;
      top: -10px;
      right: -10px;
      background: red;
      color: white;
      border-radius: 50%;
      padding: 5px;
      cursor: pointer;
    }

    .sticker .color-picker {
      position: absolute;
      bottom: -30px;
      left: 0;
    }

    .add-sticker-btn, .save-video-btn {
      margin-top: 10px;
      padding: 10px;
      background: linear-gradient(45deg, #ff00cc, #6600ff);
      border: none;
      color: #fff;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Mavjud HTML'ingiz shu yerda qoladi -->

  <!-- Video Yuklash Modali -->
  <div id="uploadModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal()">&times;</span>
      <h3>Video Yuklash</h3>
      <input type="file" id="videoFile" accept="video/*">
      <input type="text" id="videoTitle" placeholder="Sarlavha">
      <input type="text" id="keywords" placeholder="Kalit so'zlar (comma bilan ajratilgan, masalan: motivatsiya, vlog)">
      <select id="playlistSelect">
        <option value="">Pleylist tanlang</option>
        <!-- JS bilan to'ldiriladi -->
      </select>
      <input type="text" id="newPlaylist" placeholder="Yangi pleylist nomi">
      <button onclick="createNewPlaylist()">Yangi Pleylist Yaratish</button>
      <button onclick="uploadVideo()">Yuklash va Tahrirlash</button>
    </div>
  </div>

  <!-- Video Tahrirlash Sahifasi -->
  <div id="editorContainer" class="editor-container">
    <h3>Video Tahrirlash</h3>
    <div class="video-preview">
      <video id="videoPlayer" controls width="100%"></video>
      <div class="video-overlay" id="overlay"></div>
    </div>
    <button class="add-sticker-btn" onclick="addSticker()">Sticker Qo'shish</button>
    <button class="save-video-btn" onclick="saveVideo()">Saqlash</button>
  </div>

  <!-- Mavjud floating-upload -->
  <div class="floating-upload" onclick="openModal()">
    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-icon lucide-plus">
      <path d="M5 12h14"/><path d="M12 5v14"/>
    </svg>
  </div>

  <script>
    // Modal Funksiyalari
    function openModal() {
      document.getElementById('uploadModal').style.display = 'flex';
      loadPlaylists(); // Pleylistlarni yuklash
    }

    function closeModal() {
      document.getElementById('uploadModal').style.display = 'none';
    }

    // Pleylist Funksiyalari (LocalStorage bilan demo)
    function loadPlaylists() {
      const playlists = JSON.parse(localStorage.getItem('playlists')) || [];
      const select = document.getElementById('playlistSelect');
      select.innerHTML = '<option value="">Pleylist tanlang</option>';
      playlists.forEach(pl => {
        const option = document.createElement('option');
        option.value = pl;
        option.textContent = pl;
        select.appendChild(option);
      });
    }

    function createNewPlaylist() {
      const newName = document.getElementById('newPlaylist').value;
      if (newName) {
        let playlists = JSON.parse(localStorage.getItem('playlists')) || [];
        playlists.push(newName);
        localStorage.setItem('playlists', JSON.stringify(playlists));
        loadPlaylists();
        document.getElementById('newPlaylist').value = '';
      }
    }

    // Video Yuklash va Tahrirlashga O'tkazish
    function uploadVideo() {
      const file = document.getElementById('videoFile').files[0];
      if (!file) return alert('Video tanlang!');
      
      const videoURL = URL.createObjectURL(file);
      document.getElementById('videoPlayer').src = videoURL;
      
      // Modalni yopish va editorni ochish
      closeModal();
      document.getElementById('editorContainer').style.display = 'block';
      
      // Sarlavha va kalit so'zlarni saqlash (demo)
      const title = document.getElementById('videoTitle').value;
      const keywords = document.getElementById('keywords').value.split(',');
      const playlist = document.getElementById('playlistSelect').value;
      console.log({ title, keywords, playlist }); // Realda backendga jo'natish
    }

    // Sticker Funksiyalari
    let stickerCount = 0;
    function addSticker() {
      stickerCount++;
      const sticker = document.createElement('div');
      sticker.className = 'sticker';
      sticker.style.left = '50px';
      sticker.style.top = '50px';
      sticker.innerHTML = `
        <span contenteditable="true">Havola matni</span>
        <input type="text" placeholder="URL" class="url-input" style="width:100%; margin-top:5px;">
        <div class="delete-btn" onclick="this.parentNode.remove()">X</div>
        <input type="color" class="color-picker" onchange="this.parentNode.style.backgroundColor = this.value + 'cc';"> <!-- Rang tanlash -->
      `;
      sticker.onclick = function() {
        const url = sticker.querySelector('.url-input').value;
        if (url) window.open(url, '_blank'); // Havola bosilsa ochiladi
      };

      // Drag Funksiyasi
      let isDragging = false;
      let offsetX, offsetY;
      sticker.addEventListener('mousedown', (e) => {
        isDragging = true;
        offsetX = e.clientX - sticker.getBoundingClientRect().left;
        offsetY = e.clientY - sticker.getBoundingClientRect().top;
      });
      document.addEventListener('mousemove', (e) => {
        if (isDragging) {
          sticker.style.left = (e.clientX - offsetX) + 'px';
          sticker.style.top = (e.clientY - offsetY) + 'px';
        }
      });
      document.addEventListener('mouseup', () => { isDragging = false; });

      // Matn Edit: contenteditable bilan avtomatik

      document.getElementById('overlay').appendChild(sticker);
    }

    // Video Saqlash (Demo: Konsolga chiqarish)
    function saveVideo() {
      // Stickerlarni saqlash logikasi (realda serverga jo'natish)
      const stickers = Array.from(document.querySelectorAll('.sticker')).map(s => ({
        text: s.querySelector('span').innerText,
        url: s.querySelector('.url-input').value,
        position: { left: s.style.left, top: s.style.top },
        size: { width: s.style.width, height: s.style.height },
        color: s.style.backgroundColor
      }));
      console.log('Saqlangan video va stickerlar:', stickers);
      alert('Video saqlandi!'); // Realda profilga qo'shish
      document.getElementById('editorContainer').style.display = 'none';
    }
  </script>
</body>
</html>