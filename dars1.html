<!DOCTYPE html><html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>So'z tartibi testi</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #ffffff;
      color: #333;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
    }
    h1 {
      text-align: center;
    }
    .progress-bar {
      height: 10px;
      background-color: #eee;
      border-radius: 5px;
      overflow: hidden;
      margin: 20px 0;
    }
    .progress-fill {
      height: 100%;
      width: 100%;
      background-color: #007bff;
      transition: width 0.3s;
    }
    .word-btn {
      display: inline-block;
      background-color: #007bff;
      color: #fff;
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
    }
    .word-btn:hover {
      background-color: #0056b3;
    }
    .chip {
      display: inline-block;
      background-color: #e0e0e0;
      padding: 8px 15px;
      border-radius: 25px;
      margin: 5px;
      font-weight: bold;
    }
    #check-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
    }
    #check-btn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    #feedback {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    #result-actions {
      margin-top: 30px;
      text-align: center;
      display: none;
    }
    #result-actions button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 25px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>So'zlarni to'g'ri joylashtiring</h1>
  <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
  <div id="selected"></div>
  <div id="options"></div>
  <button id="check-btn" disabled>Tekshirish</button>
  <div id="feedback"></div>
  <div id="result-actions">
    <button onclick="location.href='dars5.html'">Keyingi dars</button>
    <button onclick="location.href='index.html'">Menyuga qaytish</button>
  </div>
</div><script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD0gBUJNcrgvvntcrfKK7Ky8t6_9Qb96Io",
    authDomain: "bilimilova-64833.firebaseapp.com",
    projectId: "bilimilova-64833"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const tg = window.Telegram?.WebApp;
  const uid = tg?.initDataUnsafe?.user?.id?.toString() || null;

  const sentence = ["I", "am", "a", "student"];
  const correctSentence = sentence.join(" ");

  const selectedEl = document.getElementById("selected");
  const optionsEl = document.getElementById("options");
  const checkBtn = document.getElementById("check-btn");
  const feedbackEl = document.getElementById("feedback");
  const progress = document.getElementById("progress");

  let selectedWords = [];
  let used = [];

  function renderWords() {
    selectedEl.innerHTML = selectedWords.map(word => `<span class="chip">${word}</span>`).join(" ");
    optionsEl.innerHTML = "";
    sentence.forEach((word, index) => {
      if (!used.includes(index)) {
        const btn = document.createElement("button");
        btn.textContent = word;
        btn.className = "word-btn";
        btn.onclick = () => {
          selectedWords.push(word);
          used.push(index);
          renderWords();
          if (selectedWords.length === sentence.length) checkBtn.disabled = false;
        };
        optionsEl.appendChild(btn);
      }
    });
  }

  checkBtn.onclick = async () => {
    const userSentence = selectedWords.join(" ");
    if (userSentence === correctSentence) {
      feedbackEl.textContent = "To‘g‘ri!";
      if (uid) {
        const ref = doc(db, "users", uid);
        const snap = await getDoc(ref);
        const current = snap.exists() ? snap.data().a1_score || 0 : 0;
        await setDoc(ref, { a1_score: current + 1 }, { merge: true });
      } else {
        const local = parseInt(localStorage.getItem("a1_score")) || 0;
        localStorage.setItem("a1_score", local + 1);
      }
    } else {
      feedbackEl.textContent = "Noto‘g‘ri. To‘g‘ri javob: " + correctSentence;
    }
    checkBtn.disabled = true;
    document.getElementById("result-actions").style.display = "block";
    progress.style.width = "100%";
  };

  renderWords();
</script></body>
</html>