<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Yuklash</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    body {
      background-color: #0f0f0f;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
    }

    .upload-container {
      width: 100%;
      max-width: 600px;
      background-color: #1a1a1a;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 30px;
    }

    .back-btn {
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background 0.3s;
    }

    .back-btn:hover {
      background: #333;
    }

    .title {
      font-size: 24px;
      font-weight: 600;
    }

    /* UPLOAD AREA */
    .upload-area {
      border: 3px dashed #333;
      border-radius: 10px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 30px;
      position: relative;
    }

    .upload-area:hover {
      border-color: #ff0000;
      background: rgba(255, 0, 0, 0.05);
    }

    .upload-area.drag-over {
      border-color: #ff0000;
      background: rgba(255, 0, 0, 0.1);
      transform: scale(1.02);
    }

    .upload-icon {
      font-size: 48px;
      margin-bottom: 15px;
      color: #666;
    }

    .upload-text {
      margin-bottom: 10px;
      font-size: 18px;
      color: #fff;
    }

    .upload-subtext {
      color: #666;
      margin-bottom: 20px;
      font-size: 14px;
    }

    .browse-btn {
      background: #ff0000;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: background 0.3s;
    }

    .browse-btn:hover {
      background: #cc0000;
    }

    .file-info {
      background: #272727;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
      display: none;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .file-name {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .remove-btn {
      background: none;
      border: none;
      color: #ff4d4d;
      cursor: pointer;
      padding: 5px;
      margin-left: auto;
    }

    .file-details {
      color: #aaa;
      font-size: 13px;
    }

    /* FORM FIELDS */
    .form-group {
      margin-bottom: 25px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #fff;
    }

    .form-input {
      width: 100%;
      background: #272727;
      border: 2px solid #333;
      border-radius: 8px;
      padding: 15px;
      color: #fff;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    .form-input:focus {
      outline: none;
      border-color: #ff0000;
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
      font-family: inherit;
    }

    .form-info {
      color: #666;
      font-size: 13px;
      margin-top: 5px;
    }

    /* UPLOAD BUTTON */
    .upload-btn {
      width: 100%;
      background: #ff0000;
      color: white;
      border: none;
      padding: 18px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s;
    }

    .upload-btn:hover:not(:disabled) {
      background: #cc0000;
      transform: translateY(-2px);
    }

    .upload-btn:disabled {
      background: #333;
      cursor: not-allowed;
      opacity: 0.6;
    }

    /* PROGRESS BAR */
    .upload-progress {
      background: #272727;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      display: none;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .progress-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .progress-title {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .progress-bar {
      height: 6px;
      background: #333;
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress-fill {
      height: 100%;
      background: #ff0000;
      border-radius: 3px;
      transition: width 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #aaa;
    }

    /* SUCCESS MESSAGE */
    .success-message {
      background: rgba(0, 255, 0, 0.1);
      border: 1px solid #00ff00;
      border-radius: 10px;
      padding: 25px;
      text-align: center;
      margin-top: 20px;
      display: none;
      animation: successSlide 0.5s ease;
    }

    @keyframes successSlide {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .success-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    .success-title {
      font-size: 20px;
      margin-bottom: 10px;
      color: #00ff00;
    }

    .success-text {
      color: #aaa;
      margin-bottom: 20px;
    }

    .success-btn {
      background: #ff0000;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-weight: 500;
      cursor: pointer;
    }

    /* LOADING SPINNER */
    .loading-spinner {
      width: 20px;
      height: 20px;
      border: 2px solid #fff;
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .upload-container {
        padding: 20px;
      }
      
      .title {
        font-size: 20px;
      }
      
      .upload-area {
        padding: 30px 15px;
      }
      
      .upload-btn {
        padding: 15px;
        font-size: 15px;
      }
      
      body {
        padding: 15px;
      }
    }

    @media (max-width: 480px) {
      .upload-container {
        padding: 15px;
      }
      
      .header {
        margin-bottom: 20px;
      }
      
      .title {
        font-size: 18px;
      }
      
      .upload-text {
        font-size: 16px;
      }
      
      .form-input {
        padding: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="upload-container">
    <!-- Header -->
    <div class="header">
      <button class="back-btn" id="backBtn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
      </button>
      <h1 class="title">Video Yuklash</h1>
    </div>

    <!-- Upload Area -->
    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">ðŸ“¹</div>
      <div class="upload-text">Videoni bu yerga sudrab tashlang</div>
      <div class="upload-subtext">yoki</div>
      <button class="browse-btn" id="browseBtn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        Fayl tanlash
      </button>
      <div class="form-info">MP4, AVI, MOV formatlari qo'llab-quvvatlanadi. Maksimum hajm: 500MB</div>
    </div>

    <!-- File Info -->
    <div class="file-info" id="fileInfo">
      <div class="file-name">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6C4.9 2 4.01 2.9 4.01 4L4 20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM6 20V4H13V9H18V20H6Z"/>
        </svg>
        <span id="fileName"></span>
        <button class="remove-btn" id="removeBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="file-details" id="fileDetails"></div>
    </div>

    <!-- Form Fields -->
    <div class="form-group">
      <label class="form-label">Video sarlavhasi</label>
      <input type="text" class="form-input" id="videoTitle" placeholder="Video nomini kiriting" maxlength="100">
      <div class="form-info">Maksimum 100 ta belgi</div>
    </div>

    <div class="form-group">
      <label class="form-label">Video tavsifi</label>
      <textarea class="form-input form-textarea" id="videoDescription" placeholder="Video haqida ma'lumot..."></textarea>
      <div class="form-info">Ixtiyoriy</div>
    </div>

    <!-- Upload Button -->
    <button class="upload-btn" id="uploadBtn" disabled>
      Video Yuklash
    </button>

    <!-- Progress Bar -->
    <div class="upload-progress" id="uploadProgress">
      <div class="progress-header">
        <div class="progress-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Video yuklanmoqda...
        </div>
        <span id="progressPercent">0%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
      <div class="progress-info">
        <span id="timeRemaining">Taxminiy vaqt: 30 soniya</span>
        <span id="uploadSpeed"></span>
      </div>
    </div>

    <!-- Success Message -->
    <div class="success-message" id="successMessage">
      <div class="success-icon">âœ…</div>
      <h2 class="success-title">Video muvaffaqiyatli yuklandi!</h2>
      <p class="success-text">Video profilingizga qo'shildi</p>
      <button class="success-btn" id="viewBtn">Videoni ko'rish</button>
    </div>
  </div>

  <input type="file" id="fileInput" accept="video/*" style="display: none;">

  <script>
    // ========== INITIALIZATION ==========
    document.addEventListener('DOMContentLoaded', function() {
      initializeUploadPage();
    });

    // ========== GLOBAL VARIABLES ==========
    let selectedFile = null;
    let uploadInProgress = false;
    let uploadStartTime = null;

    // ========== MAIN INITIALIZATION FUNCTION ==========
    function initializeUploadPage() {
      // Elementlarni tanlab olish
      const backBtn = document.getElementById('backBtn');
      const browseBtn = document.getElementById('browseBtn');
      const uploadArea = document.getElementById('uploadArea');
      const fileInput = document.getElementById('fileInput');
      const removeBtn = document.getElementById('removeBtn');
      const uploadBtn = document.getElementById('uploadBtn');
      const viewBtn = document.getElementById('viewBtn');
      const videoTitle = document.getElementById('videoTitle');
      const videoDescription = document.getElementById('videoDescription');
      
      // Orqaga qaytish
      backBtn.addEventListener('click', function() {
        if (uploadInProgress) {
          if (confirm("Yuklash davom etmoqda. Chiqishni istaysizmi?")) {
            window.location.href = 'profil.html';
          }
        } else {
          window.location.href = 'profil.html';
        }
      });
      
      // Fayl tanlash
      browseBtn.addEventListener('click', function() {
        fileInput.click();
      });
      
      // Fayl input
      fileInput.addEventListener('change', handleFileSelect);
      
      // Faylni olib tashlash
      removeBtn.addEventListener('click', removeSelectedFile);
      
      // Drag and drop
      setupDragAndDrop(uploadArea, fileInput);
      
      // Form validation
      videoTitle.addEventListener('input', validateForm);
      videoDescription.addEventListener('input', validateForm);
      
      // Upload button
      uploadBtn.addEventListener('click', handleUpload);
      
      // View button
      viewBtn.addEventListener('click', function() {
        window.location.href = 'videopage.html';
      });
      
      // Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          backBtn.click();
        }
      });
    }

    // ========== DRAG AND DROP ==========
    function setupDragAndDrop(uploadArea, fileInput) {
      // Drag over
      uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.classList.add('drag-over');
      });
      
      // Drag leave
      uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('drag-over');
      });
      
      // Drop
      uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('drag-over');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleVideoFile(files[0]);
        }
      });
      
      // Click to select
      uploadArea.addEventListener('click', function(e) {
        if (!e.target.closest('.browse-btn')) {
          fileInput.click();
        }
      });
    }

    
    // ========== FILE HANDLING ==========
    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (file) {
        handleVideoFile(file);
      }
    }

    function handleVideoFile(file) {
      // Video fayl ekanligini tekshirish
      if (!file.type.startsWith('video/')) {
        alert('Iltimos, faqat video fayllarni tanlang!');
        return;
      }
      
      // Fayl hajmini tekshirish (500MB)
      if (file.size > 500 * 1024 * 1024) {
        alert('Fayl hajmi 500MB dan oshmasligi kerak!');
        return;
      }
      
      selectedFile = file;
      showFileInfo(file);
      validateForm();
    }

    function showFileInfo(file) {
      const fileInfo = document.getElementById('fileInfo');
      const fileName = document.getElementById('fileName');
      const fileDetails = document.getElementById('fileDetails');
      
      // Fayl nomi
      fileName.textContent = file.name;
      
      // Fayl hajmi
      const fileSize = formatFileSize(file.size);
      const fileType = file.type.split('/')[1].toUpperCase();
      
      // Video ma'lumotlarini olish
      const video = document.createElement('video');
      video.preload = 'metadata';
      
      video.onloadedmetadata = function() {
        const duration = Math.floor(video.duration);
        const minutes = Math.floor(duration / 60);
        const seconds = duration % 60;
        
        fileDetails.innerHTML = `
          Hajmi: ${fileSize} | Format: ${fileType} | Davomiyligi: ${minutes}:${seconds.toString().padStart(2, '0')}
        `;
        
        URL.revokeObjectURL(video.src);
      };
      
      video.onerror = function() {
        fileDetails.textContent = `Hajmi: ${fileSize} | Format: ${fileType}`;
      };
      
      video.src = URL.createObjectURL(file);
      
      // Fayl ma'lumotlarini ko'rsatish
      fileInfo.style.display = 'block';
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
      else return (bytes / 1048576).toFixed(1) + ' MB';
    }

    function removeSelectedFile() {
      selectedFile = null;
      document.getElementById('fileInput').value = '';
      document.getElementById('fileInfo').style.display = 'none';
      validateForm();
    }

    // ========== FORM VALIDATION ==========
    function validateForm() {
      const title = document.getElementById('videoTitle').value.trim();
      const uploadBtn = document.getElementById('uploadBtn');
      
      // Video sarlavhasi va fayl tanlangan bo'lishi kerak
      uploadBtn.disabled = !(title.length >= 3 && selectedFile);
    }

    // ========== UPLOAD PROCESS ==========
    function handleUpload() {
      if (uploadInProgress) return;
      
      const title = document.getElementById('videoTitle').value.trim();
      const description = document.getElementById('videoDescription').value.trim();
      
      if (!selectedFile || title.length < 3) {
        alert('Iltimos, barcha maydonlarni to\'ldiring!');
        return;
      }
      
      uploadInProgress = true;
      uploadStartTime = Date.now();
      
      // UI ni yashirish
      document.getElementById('uploadBtn').style.display = 'none';
      document.getElementById('uploadProgress').style.display = 'block';
      document.getElementById('videoTitle').disabled = true;
      document.getElementById('videoDescription').disabled = true;
      
      // Yuklash jarayonini boshlash
      startUpload(title, description);
    }

    function startUpload(title, description) {
      let progress = 0;
      const totalTime = 10000; // 10 soniya (simulyatsiya)
      const intervalTime = 100;
      const increment = (intervalTime / totalTime) * 100;
      
      const uploadInterval = setInterval(() => {
        progress += increment;
        if (progress >= 100) {
          progress = 100;
          clearInterval(uploadInterval);
          completeUpload(title, description);
        }
        
        updateProgress(progress);
      }, intervalTime);
    }

    function updateProgress(progress) {
      const progressFill = document.getElementById('progressFill');
      const progressPercent = document.getElementById('progressPercent');
      const timeRemaining = document.getElementById('timeRemaining');
      const uploadSpeed = document.getElementById('uploadSpeed');
      
      // Progress bar
      progressFill.style.width = progress + '%';
      progressPercent.textContent = Math.floor(progress) + '%';
      
      // Qolgan vaqt
      const elapsedTime = Date.now() - uploadStartTime;
      const totalEstimatedTime = elapsedTime / (progress / 100);
      const remainingTime = Math.max(0, totalEstimatedTime - elapsedTime);
      const remainingSeconds = Math.ceil(remainingTime / 1000);
      
      timeRemaining.textContent = `Taxminiy vaqt: ${remainingSeconds} soniya`;
      
      // Yuklash tezligi
      if (selectedFile) {
        const uploadedBytes = (progress / 100) * selectedFile.size;
        const speed = uploadedBytes / (elapsedTime / 1000); // Bytes per second
        uploadSpeed.textContent = formatSpeed(speed);
      }
    }

    function formatSpeed(bytesPerSecond) {
      if (bytesPerSecond < 1024) {
        return bytesPerSecond.toFixed(0) + ' B/s';
      } else if (bytesPerSecond < 1048576) {
        return (bytesPerSecond / 1024).toFixed(1) + ' KB/s';
      } else {
        return (bytesPerSecond / 1048576).toFixed(1) + ' MB/s';
      }
    }

    function completeUpload(title, description) {
      // Video URL ni yaratish (simulyatsiya)
      const videoUrl = URL.createObjectURL(selectedFile);
      
      // Video ma'lumotlarini yaratish
      const videoData = {
        id: Date.now(),
        title: title,
        description: description,
        videoUrl: videoUrl,
        fileName: selectedFile.name,
        fileSize: selectedFile.size,
        date: new Date().toISOString(),
        views: 0,
        likes: 0,
        comments: 0,
        status: 'uploaded'
      };
      
      // Videoni saqlash
      saveVideo(videoData);
      
      // Progress bar ni yashirish
      document.getElementById('uploadProgress').style.display = 'none';
      
      // Muvaffaqiyat xabarini ko'rsatish
      document.getElementById('successMessage').style.display = 'block';
      
      // Ovoz chiqarish
      playSuccessSound();
    }

    function saveVideo(videoData) {
      // Joriy videoni saqlash
      localStorage.setItem('currentVideo', JSON.stringify(videoData));
      
      // Barcha videolar ro'yxatiga qo'shish
      let videos = JSON.parse(localStorage.getItem('userVideos')) || [];
      videos.push(videoData);
      localStorage.setItem('userVideos', JSON.stringify(videos));
    }

    function playSuccessSound() {
      try {
        // Simple success beep
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
        oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
        oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
      } catch (e) {
        // Audio context not supported
      }
    }
  </script>
</body>
</html>