<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yangi Video Yuklash</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            background-color: #000;
            color: #fff;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            align-items: flex-start;
            padding: 20px 0;
        }

        .video-modal-content {
            background-color: #000;
            width: 600px;
            border-radius: 16px;
            border: 1px solid #2f3336;
            overflow: hidden;
        }

        .video-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #2f3336;
        }

        .video-cancel-btn, .video-post-btn {
            background: none;
            border: none;
            color: #1da1f2;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .video-post-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .video-modal-title {
            font-size: 18px;
            font-weight: 700;
        }

        .video-form-container {
            padding: 15px;
        }

        .video-preview {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 nisbat */
            background-color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .video-preview video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-preview-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #8b98a5;
        }

        .video-preview-placeholder svg {
            margin-bottom: 10px;
            opacity: 0.7;
        }

        .video-form-group {
            margin-bottom: 20px;
        }

        .video-form-group label {
            display: block;
            margin-bottom: 5px;
            color: #8b98a5;
            font-size: 14px;
        }

        .video-form-group input,
        .video-form-group textarea {
            width: 100%;
            background-color: transparent;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 10px;
            color: #fff;
            font-size: 16px;
        }

        .video-form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .video-form-group input:focus,
        .video-form-group textarea:focus {
            border-color: #1da1f2;
            outline: none;
        }

        .upload-video-btn {
            background-color: #1da1f2;
            color: #fff;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .upload-video-btn:hover {
            background-color: #0c84d1;
        }

        .video-info {
            color: #8b98a5;
            font-size: 12px;
            margin-top: 5px;
        }

        .progress-bar-container {
            margin-top: 10px;
            height: 4px;
            background-color: #333;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #1da1f2;
            width: 0%;
            transition: width 0.3s ease;
        }

        .upload-status {
            font-size: 14px;
            color: #8b98a5;
            margin-top: 5px;
        }

        @media (max-width: 640px) {
            .video-modal-content {
                width: 95%;
            }
            
            body {
                padding: 10px 0;
            }
        }
    </style>
</head>
<body>

    <div class="video-modal-content">
        <div class="video-modal-header">
            <button class="video-cancel-btn" id="videoCancelBtn">Bekor qilish</button>
            <div class="video-modal-title">Yangi video yuklash</div>
            <button class="video-post-btn" id="videoPostBtn" disabled>Saqlash</button>
        </div>
        <div class="video-form-container">
            <div class="video-form-group">
                <label>Video (16:9 formatda bo'lishi kerak)</label>
                <div class="video-preview" id="videoPreview">
                    <div class="video-preview-placeholder">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2H6C4.9 2 4.01 2.9 4.01 4L4 20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM6 20V4H13V9H18V20H6Z" fill="currentColor"/>
                            <path d="M8 12H16V14H8V12ZM8 16H16V18H8V16Z" fill="currentColor"/>
                        </svg>
                        Video yuklang
                        <button class="upload-video-btn" id="uploadVideoBtn" style="margin-top: 15px;">Video yuklash</button>
                    </div>
                </div>
                <div class="progress-bar-container" style="display: none;" id="progressContainer">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="upload-status" id="uploadStatus"></div>
                <div class="video-info">Iltimos, 16:9 formatdagi videolarni yuklang (masalan: 1920x1080, 1280x720)</div>
            </div>
            <div class="video-form-group">
                <label for="videoTitle">Sarlavha yozing *</label>
                <input type="text" id="videoTitle" placeholder="Video sarlavhasi...">
            </div>
            <div class="video-form-group">
                <label for="videoDescription">Tavsif</label>
                <textarea id="videoDescription" placeholder="Video tavsifi..."></textarea>
            </div>
            <div class="video-form-group">
                <label for="videoKeywords">Kalit so ªzlar</label>
                <input type="text" id="videoKeywords" placeholder="Kalit so'zlar, vergul bilan ajratilgan...">
            </div>
        </div>
    </div>

    <input type="file" id="videoInput" accept="video/*" style="display: none;">

    <script>
        const videoCancelBtn = document.getElementById('videoCancelBtn');
        const videoPostBtn = document.getElementById('videoPostBtn');
        const uploadVideoBtn = document.getElementById('uploadVideoBtn');
        const videoInput = document.getElementById('videoInput');
        const videoPreview = document.getElementById('videoPreview');
        const videoTitle = document.getElementById('videoTitle');
        const videoDescription = document.getElementById('videoDescription');
        const videoKeywords = document.getElementById('videoKeywords');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const uploadStatus = document.getElementById('uploadStatus');

        let selectedVideoFile = null;
        let videoId = null;

        // Yuklash tugmasi
        uploadVideoBtn.addEventListener('click', () => videoInput.click());

        // Video faylni tanlash
        videoInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            selectedVideoFile = file;

            // Video formatini tekshirish
            const video = document.createElement('video');
            video.preload = 'metadata';
            
            video.onloadedmetadata = function() {
                window.URL.revokeObjectURL(video.src);
                const videoRatio = video.videoWidth / video.videoHeight;
                const targetRatio = 16/9;
                const ratioDiff = Math.abs(videoRatio - targetRatio);
                
                // Agar video 16:9 formatda bo'lmasa, ogohlantirish
                if (ratioDiff > 0.1) {
                    const confirmUpload = confirm(`Sizning videoning o'lchami ${video.videoWidth}x${video.videoHeight} (${videoRatio.toFixed(2)}:1).\nBu 16:9 (1.78:1) formatda emas. Davom etasizmi?`);
                    if (!confirmUpload) {
                        videoInput.value = '';
                        selectedVideoFile = null;
                        return;
                    }
                }
                
                // Video yuklash
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const videoElement = document.createElement('video');
                    videoElement.src = ev.target.result;
                    videoElement.controls = true;
                    videoPreview.innerHTML = '';
                    videoPreview.appendChild(videoElement);
                    
                    // Formani faollashtirish
                    checkFormValidity();
                };
                reader.readAsDataURL(file);
            };
            
            video.src = URL.createObjectURL(file);
        });

        // Form maydonlarini tekshirish
        function checkFormValidity() {
            const titleValid = videoTitle.value.trim().length > 0;
            const videoSelected = selectedVideoFile !== null;
            
            videoPostBtn.disabled = !(titleValid && videoSelected);
        }

        videoTitle.addEventListener('input', checkFormValidity);
        videoDescription.addEventListener('input', checkFormValidity);
        videoKeywords.addEventListener('input', checkFormValidity);

        // Bekor qilish
        videoCancelBtn.addEventListener('click', () => {
            if (confirm("Haqiqatan ham sahifani tark etmoqchimisiz? Yuklanayotgan video saqlanmaydi.")) {
                window.location.href = 'profil.html';
            }
        });

        // Video yuklash
        videoPostBtn.addEventListener('click', async () => {
            if (!selectedVideoFile || !videoTitle.value.trim()) {
                alert("Iltimos, video va sarlavhani kiriting!");
                return;
            }

            try {
                // Post tugmasini o'chirish
                videoPostBtn.disabled = true;
                videoCancelBtn.disabled = true;
                videoPostBtn.textContent = "Yuklanmoqda...";

                // Progress barlarini ko'rsatish
                progressContainer.style.display = 'block';
                uploadStatus.textContent = "Video yuklanmoqda...";

                // Video ID yaratish
                videoId = 'video_' + Date.now();

                // Mock yuklash jarayoni (real loyihada bu serverga yuklash bo'ladi)
                const totalSteps = 100;
                let currentStep = 0;

                const uploadInterval = setInterval(() => {
                    currentStep += 2;
                    progressBar.style.width = currentStep + '%';

                    if (currentStep <= 25) {
                        uploadStatus.textContent = "Video tekshirilmoqda...";
                    } else if (currentStep <= 50) {
                        uploadStatus.textContent = "Video qayta ishlanmoqda...";
                    } else if (currentStep <= 75) {
                        uploadStatus.textContent = "Thumbnail yaratilmoqda...";
                    } else if (currentStep <= 95) {
                        uploadStatus.textContent = "Saqlanmoqda...";
                    }

                    if (currentStep >= 100) {
                        clearInterval(uploadInterval);
                        
                        // LocalStorage ga saqlash
                        const newVideo = {
                            id: videoId,
                            title: videoTitle.value.trim(),
                            description: videoDescription.value.trim(),
                            keywords: videoKeywords.value.split(',').map(k => k.trim()).filter(k => k),
                            fileName: selectedVideoFile.name,
                            fileSize: formatFileSize(selectedVideoFile.size),
                            duration: '0:00', // Haqiqiy loyihada video davomiyligini olish kerak
                            thumbnail: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=500&q=60',
                            uploadDate: new Date().toLocaleDateString('uz-UZ'),
                            views: 0,
                            likes: 0,
                            comments: 0,
                            status: 'uploaded'
                        };

                        // Mavjud videolarni olish
                        const existingVideos = JSON.parse(localStorage.getItem('userVideos')) || [];
                        
                        // Yangi videoni qo'shish
                        existingVideos.unshift(newVideo);
                        localStorage.setItem('userVideos', JSON.stringify(existingVideos));

                        // Profilga o'tish
                        alert("Video muvaffaqiyatli yuklandi!");
                        window.location.href = 'profil.html';
                    }
                }, 100);

            } catch (error) {
                console.error('Yuklashda xato:', error);
                alert("Video yuklashda xato yuz berdi. Iltimos, qayta urinib ko'ring.");
                
                // Tugmalarni tiklash
                videoPostBtn.disabled = false;
                videoCancelBtn.disabled = false;
                videoPostBtn.textContent = "Saqlash";
                progressContainer.style.display = 'none';
                uploadStatus.textContent = "";
            }
        });

        // Fayl hajmini formatlash
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }
    </script>
</body>
</html>