<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StoryLearn â€” Tooltip va Audio Sync</title>
  <style>
    :root{
      --bg:#0b0d10;
      --card:#101216;
      --muted:#9aa3a8;
      --text:#e6eef1;
      --accent:#00c4a7;
    }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: Inter, sans-serif; display:flex;
      justify-content:center; align-items:center; height:100vh; padding:20px;
    }
    .app{
      max-width:750px; width:100%; background:rgba(255,255,255,0.02);
      border-radius:20px; padding:20px; box-shadow:0 0 30px rgba(0,0,0,0.4);
    }
    h1{color:var(--accent);font-size:1.2rem;margin-top:0}
    .story{line-height:1.8; font-size:1.05rem; margin-bottom:16px}
    .word{
      cursor:pointer; padding:2px 4px; border-radius:6px; transition:background .15s;
    }
    .word:hover{background:rgba(0,196,167,0.07);}
    .word.active{
      background:rgba(0,196,167,0.25);
      box-shadow:0 0 6px rgba(0,196,167,0.5);
    }
    .tooltip{
      position:absolute; background:#fff; color:#021; padding:6px 10px;
      border-radius:8px; font-size:0.9rem; box-shadow:0 4px 20px rgba(0,0,0,0.4);
      transform:translate(-50%,-150%) scale(.9); opacity:0;
      transition:opacity .18s, transform .2s; pointer-events:none;
      white-space:nowrap; z-index:50;
    }
    .tooltip.show{opacity:1; transform:translate(-50%,-160%) scale(1);}
    .controls{display:flex;gap:10px;align-items:center;margin-top:14px;}
    .btn{
      background:var(--accent);border:none;color:#001b18;
      padding:10px 16px;border-radius:10px;font-weight:600;cursor:pointer;
    }
    select{padding:6px 10px;border-radius:8px;background:#111;color:#eee;border:none}
    .progress{height:8px;background:#111;border-radius:999px;overflow:hidden;margin-top:8px;}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#7efbd4);}
  </style>
</head>
<body>
  <div class="app">
    <h1>My Family</h1>
    <div class="story" id="storyArea">
      <p id="storyText">
        <span class="word" data-uz="Mening">My</span>
        <span class="word" data-uz="oila">family</span>
        <span class="word" data-uz="men uchun">is</span>
        <span class="word" data-uz="juda muhim">very important</span>
        <span class="word" data-uz="menga">to</span>
        <span class="word" data-uz="men">me</span>.
        <br><br>
        <span class="word" data-uz="Biz besh kishimiz">We are five people</span>
        <span class="word" data-uz="oilamizda">in my family</span>:
        <span class="word" data-uz="otam">my father</span>,
        <span class="word" data-uz="onam">my mother</span>,
        <span class="word" data-uz="opam">my sister</span>,
        <span class="word" data-uz="akam">my brother</span>,
        <span class="word" data-uz="va men">and me</span>.
      </p>
      <div class="tooltip" id="tooltip"><span id="tpText">Tarjima</span></div>
    </div>

    <div class="controls">
      <button class="btn" id="play">â–¶</button>
      <button class="btn" id="back5">â—€â—€ 5s</button>
      <button class="btn" id="forward5">5s â–¶â–¶</button>
      <select id="speed">
        <option value="0.75">0.75x</option>
        <option value="1" selected>1x</option>
        <option value="1.25">1.25x</option>
      </select>
      <div id="time" style="margin-left:auto;font-size:0.9rem;color:#aaa">0:00 / 0:00</div>
    </div>
    <div class="progress"><div class="bar" id="progressBar"></div></div>

    <audio id="audio" src="https://www.englishlisteninghub.com/wp-content/uploads/2021/10/my-family.mp3"></audio>
  </div>

  <script>
  const words = [...document.querySelectorAll('.word')];
  const tooltip = document.getElementById('tooltip');
  const tpText = document.getElementById('tpText');
  const storyArea = document.getElementById('storyArea');
  let tooltipTimer=null;

  // ðŸ”Š Tooltip + tarjimani ovozda oâ€˜qish
  function showTooltipFor(el){
    const uz = el.dataset.uz || '';
    tpText.textContent = uz;
    const rect = el.getBoundingClientRect();
    const cRect = storyArea.getBoundingClientRect();
    tooltip.style.left = (rect.left + rect.width/2 - cRect.left) + 'px';
    tooltip.style.top = (rect.top - cRect.top) + 'px';
    tooltip.classList.add('show');
    if('speechSynthesis' in window && uz.trim()!==''){
      const u = new SpeechSynthesisUtterance(uz);
      u.lang = 'uz-UZ';
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }
    clearTimeout(tooltipTimer);
    tooltipTimer=setTimeout(()=>tooltip.classList.remove('show'),1800);
  }

  words.forEach(w=>{
    w.addEventListener('click',e=>{
      e.stopPropagation(); showTooltipFor(w);
    });
  });
  document.addEventListener('click',()=>tooltip.classList.remove('show'));

  // ðŸŽ§ Audio va sinxronlashtirish
  const audio=document.getElementById('audio');
  const playBtn=document.getElementById('play');
  const back5=document.getElementById('back5');
  const forward5=document.getElementById('forward5');
  const speed=document.getElementById('speed');
  const time=document.getElementById('time');
  const bar=document.getElementById('progressBar');

  function format(s){if(!s||isNaN(s))return'0:00';let m=Math.floor(s/60);let sec=Math.floor(s%60).toString().padStart(2,'0');return`${m}:${sec}`;}
  function updateTime(){time.textContent=`${format(audio.currentTime)} / ${format(audio.duration)}`;}

  playBtn.onclick=()=>{audio.paused?audio.play():audio.pause();};
  audio.onplay=()=>playBtn.textContent='â¸';
  audio.onpause=()=>playBtn.textContent='â–¶';
  back5.onclick=()=>audio.currentTime=Math.max(0,audio.currentTime-5);
  forward5.onclick=()=>audio.currentTime=Math.min(audio.duration,audio.currentTime+5);
  speed.onchange=()=>audio.playbackRate=parseFloat(speed.value);

  // ðŸ” Auto timestamps (taxminiy)
  const totalWords=words.length;
  let timestamps=[];
  audio.addEventListener('loadedmetadata',()=>{
    const dur=audio.duration||40; // agar metadata yoâ€˜q boâ€˜lsa
    const per=dur/totalWords;
    timestamps=words.map((w,i)=>({start:i*per,end:(i+1)*per}));
  });

  // Highlight va progress
  audio.addEventListener('timeupdate',()=>{
    const cur=audio.currentTime;
    if(timestamps.length){
      let idx=timestamps.findIndex(t=>cur>=t.start&&cur<t.end);
      words.forEach(w=>w.classList.remove('active'));
      if(idx!==-1&&words[idx])words[idx].classList.add('active');
    }
    const pct=(cur/(audio.duration||1))*100;
    bar.style.width=pct+'%';
    updateTime();
  });
  </script>
</body>
</html>