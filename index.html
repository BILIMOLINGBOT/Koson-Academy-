<!DOCTYPE html>
<html>
<head>
  <title>Telegram Mini App</title>
  <style>
    body {
      background: #fff3b0;
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    button {
      background: #4d3f00;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
      box-shadow: 0 4px 0 #3a2f00;
    }
    button:active {
      transform: translateY(2px);
      box-shadow: none;
    }
  </style>
</head>
<body>
  <h2>üì¢ Kanalga a ºzo bo ªling</h2>
  <p>Iltimos, mini ilovadan foydalanish uchun kanalga a ºzo bo ªling:</p>

  <!-- TO‚ÄòG‚ÄòRI href va target -->
  <a href="https://t.me/KosonAcademy" target="_blank">
    <button>üîó Kanalga o ªtish</button>
  </a>

  <br>

  <button onclick="checkMembership()">‚úÖ A ºzoligimni tekshirish</button>
  <p id="status"></p>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    Telegram.WebApp.expand();

    async function checkMembership() {
      const userId = Telegram.WebApp.initDataUnsafe.user?.id;

      if (!userId) {
        document.getElementById("status").textContent = "‚ùå Foydalanuvchi aniqlanmadi. Iltimos, Telegram ilovasi ichidan foydalaning.";
        return;
      }

      const res = await fetch(`/check-membership?user_id=${userId}`);
      const data = await res.json();

      const statusEl = document.getElementById("status");

      if (data.status === "member" || data.status === "administrator" || data.status === "creator") {
        statusEl.textContent = "‚úÖ Siz kanalga a ºzosiz! Davom etishingiz mumkin.";
        // Istasangiz: window.location.href = "/asosiy.html"
      } else {
        statusEl.textContent = "‚ùå Iltimos, avval kanalga a ºzo bo‚Äòling.";
      }
    }
  </script>
</body>
</html>